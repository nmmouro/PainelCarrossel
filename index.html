<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<img src="logo.png" alt="Logo" class="logo"
 onerror="this.style.display='none'">
<title>Painel - Frota (GViz)</title>

<style>
:root{
  --bg:#071029; --card:#2a71e8; --muted:#f7f9fa;
  --accent:#00eaff;
}
html,body{height:100%;margin:0;background:var(--bg);color:#fff;font-family:Arial}
header{display:flex;justify-content:space-between;align-items:center;padding:12px 20px;background:#020617}
header .title{font-size:20px;font-weight:700;color:var(--accent)}
header .clock{font-size:18px;color:var(--muted)}

main{
  padding:12px;
  display:grid;
  grid-template-rows:1fr 1fr 1fr;
  gap:12px;
  height:calc(100vh - 80px);
}

.card{background:var(--card);border-radius:10px;padding:10px;overflow:auto}
.card h2{text-align:center;color:var(--accent);margin:0 0 8px}

table{width:100%;border-collapse:collapse;font-size:14px}
th,td{padding:6px;border-bottom:1px solid rgba(255,255,255,.1)}
th{background:#0435bf}

/* carrossel */
#carousel-content{min-height:120px}
.fade{animation:fade .6s}
@keyframes fade{from{opacity:.2}to{opacity:1}}
</style>
</head>

<body>
<header>  
  <div class="title">MOVIMENTAÇÃO DIÁRIA</div>
  <div class="clock" id="clock"></div>
</header>

<main>
  <section class="card">
    <h2>PAINEL</h2>
    <div id="painel">Carregando...</div>
  </section>

  <section class="card">
    <h2>AGENDA DO DIA</h2>
    <div id="agenda">Carregando...</div>
  </section>

  <!-- CARROSSEL INFERIOR -->
  <section class="card">
  <h2 id="carousel-title">AGENDA SERVIÇO SOCIAL</h2>

  <div id="carousel">
    <div id="carousel-ss"></div>
    <div id="carousel-avisos" style="display:none"></div>
  </div>
</section>


<script>
/* ================= CONFIG ================= */
const SHEET_ID = "1Ch3AjQ0MDo4WuQWFDR3r8nZrHb4yQkSLOtT5_QgxT6E";
const TAB_PAINEL = "PAINEL";
const TAB_AGENDA = "AGENDA DO DIA";
const TAB_SS = "AGENDA SERVIÇO SOCIAL";
const TAB_AVISOS = "AVISOS";

/* ================= CLOCK ================= */
function clock(){
  const d=new Date();
  document.getElementById("clock").innerText =
    d.toLocaleDateString("pt-BR")+" "+d.toLocaleTimeString("pt-BR");
}
setInterval(clock,1000); clock();

/* ================= HELPERS ================= */
function parseGViz(t){
  const j=t.substring(t.indexOf("{"),t.lastIndexOf("}")+1);
  return JSON.parse(j);
}

function ensureElement(id){
  let el=document.getElementById(id);
  if(!el){
    el=document.createElement("div");
    el.id=id;
    document.body.appendChild(el);
  }
  return el;
}

function renderTable(containerId, json){
  const el=ensureElement(containerId);
  let html="<table><thead><tr>";
  json.table.cols.forEach(c=>html+=`<th>${c.label||""}</th>`);
  html+="</tr></thead><tbody>";
  json.table.rows.forEach(r=>{
    html+="<tr>";
    r.c.forEach(c=>html+=`<td>${c?.v ?? ""}</td>`);
    html+="</tr>";
  });
  html+="</tbody></table>";
  el.innerHTML=html;
}

/* ================= LOAD SHEETS ================= */
async function loadSheet(name){
  const url=`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(name)}`;
  const r=await fetch(url,{cache:"no-store"});
  return parseGViz(await r.text());
}

/* ================= CARROSSEL ================= */
let carouselIndex = 0;

function toggleCarousel(){
  const title = document.getElementById("carousel-title");
  const ss = document.getElementById("carousel-ss");
  const avisos = document.getElementById("carousel-avisos");

  if (carouselIndex === 0){
    ss.style.display = "block";
    avisos.style.display = "none";
    title.innerText = "AGENDA SERVIÇO SOCIAL";
  } else {
    ss.style.display = "none";
    avisos.style.display = "block";
    title.innerText = "AVISOS";
  }

  carouselIndex = (carouselIndex + 1) % 2;
}


/* ================= MAIN ================= */
async function loadAll(){
  try{
    const [p,a,ss,av] = await Promise.all([
      loadSheet(TAB_PAINEL),
      loadSheet(TAB_AGENDA),
      loadSheet(TAB_SS),
      loadSheet(TAB_AVISOS)
    ]);

    renderTable("painel", p);
    renderTable("agenda", a);
    renderTable("carousel-ss", ss);
    renderTable("carousel-avisos", av);

  }catch(e){
    console.error(e);
  }
}

loadAll();
setInterval(loadAll, 60000);
setInterval(toggleCarousel, 7000);

</script>
</body>
</html>
